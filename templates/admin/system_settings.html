{% extends "admin/professional_base.html" %}

{% block title %}System Settings - Configuration Control Center{% endblock %}

{% block page_title %}System Settings{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="dashboard-card">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <div class="card-icon bg-info-gradient me-3">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div>
                        <h2 class="mb-1 text-primary">System Settings</h2>
                        <p class="text-muted mb-0">Complete configuration control center for your platform</p>
                    </div>
                </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-warning" onclick="resetToDefaults()">
                            <i class="fas fa-undo"></i> Reset Defaults
                        </button>
                        <button class="btn btn-outline-success" onclick="exportSettings()">
                            <i class="fas fa-download"></i> Export Config
                        </button>
                        <button class="btn btn-primary" onclick="saveAllSettings()">
                            <i class="fas fa-save me-1"></i> Save All Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Navigation Tabs -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="dashboard-card">
                <div class="card-body p-2">
                    <ul class="nav nav-pills nav-fill settings-tabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#general-settings" type="button">
                            <i class="fas fa-home"></i> General
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#email-settings" type="button">
                            <i class="fas fa-envelope"></i> Email
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#security-settings" type="button">
                            <i class="fas fa-shield-alt"></i> Security
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#api-settings" type="button">
                            <i class="fas fa-plug"></i> API & Integrations
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#maintenance-settings" type="button">
                            <i class="fas fa-tools"></i> Maintenance
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="pill" data-bs-target="#advanced-settings" type="button">
                            <i class="fas fa-code"></i> Advanced
                        </button>
                    </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Content -->
    <div class="tab-content">
        <!-- General Settings -->
        <div class="tab-pane fade show active" id="general-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-info-circle text-primary me-2"></i> Site Information
                            </h6>
                        </div>
                        <div class="card-body">
                            <form id="site-info-form">
                                <div class="mb-3">
                                    <label for="site-name" class="form-label">Site Name*</label>
                                    <input type="text" class="form-control" id="site-name" value="CartMax Platform" required>
                                    <div class="form-text">This appears in browser titles and navigation</div>
                                </div>
                                <div class="mb-3">
                                    <label for="site-description" class="form-label">Site Description</label>
                                    <textarea class="form-control" id="site-description" rows="3">Your premier e-commerce platform for buying and selling products online.</textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="site-url" class="form-label">Site URL</label>
                                    <input type="url" class="form-control" id="site-url" value="https://yourdomain.com">
                                </div>
                                <div class="mb-3">
                                    <label for="admin-email" class="form-label">Administrator Email*</label>
                                    <input type="email" class="form-control" id="admin-email" value="admin@yourdomain.com" required>
                                </div>
                                <div class="mb-3">
                                    <label for="timezone" class="form-label">Default Timezone</label>
                                    <select class="form-select" id="timezone">
                                        <option value="UTC">UTC (Coordinated Universal Time)</option>
                                        <option value="America/New_York">Eastern Time (ET)</option>
                                        <option value="America/Chicago">Central Time (CT)</option>
                                        <option value="America/Denver">Mountain Time (MT)</option>
                                        <option value="America/Los_Angeles" selected>Pacific Time (PT)</option>
                                        <option value="Europe/London">London (GMT)</option>
                                        <option value="Europe/Paris">Paris (CET)</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-palette text-success me-2"></i> Appearance & Branding
                            </h6>
                        </div>
                        <div class="card-body">
                            <form id="appearance-form">
                                <div class="mb-3">
                                    <label for="theme-mode" class="form-label">Theme Mode</label>
                                    <select class="form-select" id="theme-mode">
                                        <option value="auto">Auto (System Preference)</option>
                                        <option value="light">Light Mode</option>
                                        <option value="dark" selected>Dark Mode</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="primary-color" class="form-label">Primary Color</label>
                                    <input type="color" class="form-control form-control-color" id="primary-color" value="#ffd700">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Logo Upload</label>
                                    <input class="form-control" type="file" id="logo-upload" accept="image/*">
                                    <div class="form-text">Recommended: 200x60px, PNG or SVG format</div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Favicon Upload</label>
                                    <input class="form-control" type="file" id="favicon-upload" accept="image/*">
                                    <div class="form-text">Recommended: 32x32px or 64x64px, ICO or PNG format</div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-toggle-on text-warning me-2"></i> Feature Toggles
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="user-registration" checked>
                                        <label class="form-check-label" for="user-registration">
                                            <strong>User Registration</strong><br>
                                            <small class="text-muted">Allow new users to register</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="email-verification" checked>
                                        <label class="form-check-label" for="email-verification">
                                            <strong>Email Verification</strong><br>
                                            <small class="text-muted">Require email verification for new accounts</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="guest-checkout">
                                        <label class="form-check-label" for="guest-checkout">
                                            <strong>Guest Checkout</strong><br>
                                            <small class="text-muted">Allow purchases without account</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="reviews-enabled" checked>
                                        <label class="form-check-label" for="reviews-enabled">
                                            <strong>Product Reviews</strong><br>
                                            <small class="text-muted">Enable customer product reviews</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="wishlist-enabled" checked>
                                        <label class="form-check-label" for="wishlist-enabled">
                                            <strong>Wishlist Feature</strong><br>
                                            <small class="text-muted">Allow users to save favorite products</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="analytics-tracking" checked>
                                        <label class="form-check-label" for="analytics-tracking">
                                            <strong>Analytics Tracking</strong><br>
                                            <small class="text-muted">Collect usage analytics</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Settings -->
        <div class="tab-pane fade" id="email-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-server text-primary me-2"></i> SMTP Configuration
                            </h6>
                        </div>
                        <div class="card-body">
                            <form id="smtp-form">
                                <div class="mb-3">
                                    <label for="smtp-host" class="form-label">SMTP Host*</label>
                                    <input type="text" class="form-control" id="smtp-host" placeholder="smtp.gmail.com">
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="smtp-port" class="form-label">Port*</label>
                                            <select class="form-select" id="smtp-port">
                                                <option value="25">25 (Standard)</option>
                                                <option value="465">465 (SSL)</option>
                                                <option value="587" selected>587 (TLS)</option>
                                                <option value="2525">2525 (Alternative)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="smtp-encryption" class="form-label">Encryption</label>
                                            <select class="form-select" id="smtp-encryption">
                                                <option value="none">None</option>
                                                <option value="tls" selected>TLS</option>
                                                <option value="ssl">SSL</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="smtp-username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="smtp-username">
                                </div>
                                <div class="mb-3">
                                    <label for="smtp-password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="smtp-password">
                                </div>
                                <div class="mb-3">
                                    <button type="button" class="btn btn-outline-info" onclick="testEmailConnection()">
                                        <i class="fas fa-paper-plane"></i> Test Connection
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-envelope-open text-success me-2"></i> Email Templates
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="from-name" class="form-label">From Name</label>
                                <input type="text" class="form-control" id="from-name" value="CartMax Platform">
                            </div>
                            <div class="mb-3">
                                <label for="from-email" class="form-label">From Email</label>
                                <input type="email" class="form-control" id="from-email" value="noreply@yourdomain.com">
                            </div>
                            <div class="mb-3">
                                <label for="reply-email" class="form-label">Reply-To Email</label>
                                <input type="email" class="form-control" id="reply-email" value="support@yourdomain.com">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Email Templates</label>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action" onclick="editEmailTemplate('welcome')">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Welcome Email</h6>
                                            <i class="fas fa-edit"></i>
                                        </div>
                                        <small>Sent to new users after registration</small>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" onclick="editEmailTemplate('password-reset')">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Password Reset</h6>
                                            <i class="fas fa-edit"></i>
                                        </div>
                                        <small>Password recovery instructions</small>
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" onclick="editEmailTemplate('order-confirmation')">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Order Confirmation</h6>
                                            <i class="fas fa-edit"></i>
                                        </div>
                                        <small>Sent after successful purchase</small>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Settings -->
        <div class="tab-pane fade" id="security-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-lock text-danger me-2"></i> Authentication & Passwords
                            </h6>
                        </div>
                        <div class="card-body">
                            <form id="auth-form">
                                <div class="mb-3">
                                    <label for="min-password-length" class="form-label">Minimum Password Length</label>
                                    <select class="form-select" id="min-password-length">
                                        <option value="6">6 characters</option>
                                        <option value="8" selected>8 characters</option>
                                        <option value="10">10 characters</option>
                                        <option value="12">12 characters</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password Requirements</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="require-uppercase" checked>
                                        <label class="form-check-label" for="require-uppercase">
                                            Require uppercase letters
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="require-lowercase" checked>
                                        <label class="form-check-label" for="require-lowercase">
                                            Require lowercase letters
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="require-numbers" checked>
                                        <label class="form-check-label" for="require-numbers">
                                            Require numbers
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="require-special">
                                        <label class="form-check-label" for="require-special">
                                            Require special characters
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="session-timeout" class="form-label">Session Timeout (minutes)</label>
                                    <select class="form-select" id="session-timeout">
                                        <option value="15">15 minutes</option>
                                        <option value="30" selected>30 minutes</option>
                                        <option value="60">1 hour</option>
                                        <option value="120">2 hours</option>
                                        <option value="480">8 hours</option>
                                    </select>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" id="two-factor-auth">
                                    <label class="form-check-label" for="two-factor-auth">
                                        <strong>Enable Two-Factor Authentication</strong><br>
                                        <small class="text-muted">Require 2FA for admin accounts</small>
                                    </label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-shield-alt text-warning me-2"></i> Security Policies
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="login-attempts" class="form-label">Max Login Attempts</label>
                                <select class="form-select" id="login-attempts">
                                    <option value="3">3 attempts</option>
                                    <option value="5" selected>5 attempts</option>
                                    <option value="10">10 attempts</option>
                                    <option value="0">Unlimited</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="lockout-duration" class="form-label">Account Lockout Duration</label>
                                <select class="form-select" id="lockout-duration">
                                    <option value="5">5 minutes</option>
                                    <option value="15" selected>15 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="60">1 hour</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="allowed-domains" class="form-label">Allowed Email Domains</label>
                                <textarea class="form-control" id="allowed-domains" rows="3" placeholder="Leave empty to allow all domains, or specify:\ngmail.com\nyourdomain.com"></textarea>
                                <div class="form-text">One domain per line. Leave empty to allow all domains.</div>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="csrf-protection" checked>
                                <label class="form-check-label" for="csrf-protection">
                                    <strong>CSRF Protection</strong><br>
                                    <small class="text-muted">Enable cross-site request forgery protection</small>
                                </label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="ip-logging" checked>
                                <label class="form-check-label" for="ip-logging">
                                    <strong>IP Address Logging</strong><br>
                                    <small class="text-muted">Log user IP addresses for security</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- API & Integrations -->
        <div class="tab-pane fade" id="api-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-key text-primary me-2"></i> API Keys & Authentication
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">API Keys</label>
                                <div class="api-key-item">
                                    <label class="form-label">Master API Key</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" value="sk_live_51H7..." readonly>
                                        <button class="btn btn-outline-secondary" type="button" onclick="regenerateApiKey('master')">
                                            <i class="fas fa-sync"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="api-rate-limit" class="form-label">API Rate Limit (requests/minute)</label>
                                <select class="form-select" id="api-rate-limit">
                                    <option value="60">60 requests/minute</option>
                                    <option value="100" selected>100 requests/minute</option>
                                    <option value="200">200 requests/minute</option>
                                    <option value="500">500 requests/minute</option>
                                </select>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="api-enabled" checked>
                                <label class="form-check-label" for="api-enabled">
                                    <strong>Enable Public API</strong><br>
                                    <small class="text-muted">Allow external applications to access your API</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-credit-card text-success me-2"></i> Payment Integrations
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="integration-item mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6><i class="fab fa-stripe text-primary"></i> Stripe</h6>
                                        <small class="text-muted">Credit card and digital wallet payments</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="stripe-enabled" checked>
                                    </div>
                                </div>
                            </div>
                            <div class="integration-item mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6><i class="fab fa-paypal text-primary"></i> PayPal</h6>
                                        <small class="text-muted">PayPal and PayPal Credit payments</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="paypal-enabled">
                                    </div>
                                </div>
                            </div>
                            <div class="integration-item mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6><i class="fab fa-amazon text-warning"></i> Amazon Pay</h6>
                                        <small class="text-muted">Amazon's payment service</small>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="amazon-pay-enabled">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-plug text-info me-2"></i> Third-Party Services
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="integration-card">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h6><i class="fab fa-google text-danger"></i> Google Analytics</h6>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="google-analytics">
                                            </div>
                                        </div>
                                        <input type="text" class="form-control form-control-sm" placeholder="Tracking ID (GA-XXXXXXXX)">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="integration-card">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h6><i class="fab fa-mailchimp text-warning"></i> Mailchimp</h6>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="mailchimp">
                                            </div>
                                        </div>
                                        <input type="text" class="form-control form-control-sm" placeholder="API Key">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="integration-card">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h6><i class="fab fa-aws text-warning"></i> AWS S3</h6>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="aws-s3" checked>
                                            </div>
                                        </div>
                                        <input type="text" class="form-control form-control-sm" placeholder="Bucket Name">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Maintenance Settings -->
        <div class="tab-pane fade" id="maintenance-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-wrench text-warning me-2"></i> Maintenance Mode
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="maintenance-mode">
                                <label class="form-check-label" for="maintenance-mode">
                                    <strong>Enable Maintenance Mode</strong><br>
                                    <small class="text-muted">Temporarily disable site access for maintenance</small>
                                </label>
                            </div>
                            <div class="mb-3">
                                <label for="maintenance-message" class="form-label">Maintenance Message</label>
                                <textarea class="form-control" id="maintenance-message" rows="4">We're currently performing scheduled maintenance. We'll be back online shortly!</textarea>
                            </div>
                            <div class="mb-3">
                                <label for="maintenance-end" class="form-label">Estimated End Time</label>
                                <input type="datetime-local" class="form-control" id="maintenance-end">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-database text-info me-2"></i> Database Maintenance
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Database Operations</label>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-info" onclick="optimizeDatabase()">
                                        <i class="fas fa-tools"></i> Optimize Database
                                    </button>
                                    <button class="btn btn-outline-success" onclick="createBackup()">
                                        <i class="fas fa-download"></i> Create Backup
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="clearCache()">
                                        <i class="fas fa-broom"></i> Clear Cache
                                    </button>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="auto-backup" class="form-label">Automatic Backups</label>
                                <select class="form-select" id="auto-backup">
                                    <option value="disabled">Disabled</option>
                                    <option value="daily" selected>Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="backup-retention" class="form-label">Backup Retention (days)</label>
                                <select class="form-select" id="backup-retention">
                                    <option value="7">7 days</option>
                                    <option value="30" selected>30 days</option>
                                    <option value="90">90 days</option>
                                    <option value="365">1 year</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Settings -->
        <div class="tab-pane fade" id="advanced-settings" role="tabpanel">
            <div class="row">
                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-code text-danger me-2"></i> Developer Settings
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="debug-mode">
                                <label class="form-check-label" for="debug-mode">
                                    <strong>Debug Mode</strong><br>
                                    <small class="text-muted">Enable detailed error messages (⚠️ Disable in production)</small>
                                </label>
                            </div>
                            <div class="mb-3">
                                <label for="log-level" class="form-label">Logging Level</label>
                                <select class="form-select" id="log-level">
                                    <option value="DEBUG">DEBUG (Most Verbose)</option>
                                    <option value="INFO" selected>INFO</option>
                                    <option value="WARNING">WARNING</option>
                                    <option value="ERROR">ERROR</option>
                                    <option value="CRITICAL">CRITICAL (Least Verbose)</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="cache-timeout" class="form-label">Cache Timeout (seconds)</label>
                                <input type="number" class="form-control" id="cache-timeout" value="3600" min="60">
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="compress-responses" checked>
                                <label class="form-check-label" for="compress-responses">
                                    <strong>Compress Responses</strong><br>
                                    <small class="text-muted">Enable GZIP compression for better performance</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-chart-line text-success me-2"></i> Performance Settings
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="max-upload-size" class="form-label">Max Upload Size (MB)</label>
                                <select class="form-select" id="max-upload-size">
                                    <option value="2">2 MB</option>
                                    <option value="5" selected>5 MB</option>
                                    <option value="10">10 MB</option>
                                    <option value="25">25 MB</option>
                                    <option value="50">50 MB</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="pagination-size" class="form-label">Items Per Page</label>
                                <select class="form-select" id="pagination-size">
                                    <option value="10">10 items</option>
                                    <option value="20" selected>20 items</option>
                                    <option value="50">50 items</option>
                                    <option value="100">100 items</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="search-results" class="form-label">Search Results Limit</label>
                                <select class="form-select" id="search-results">
                                    <option value="20">20 results</option>
                                    <option value="50" selected>50 results</option>
                                    <option value="100">100 results</option>
                                    <option value="200">200 results</option>
                                </select>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="cdn-enabled">
                                <label class="form-check-label" for="cdn-enabled">
                                    <strong>CDN Integration</strong><br>
                                    <small class="text-muted">Use Content Delivery Network for static files</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h6 class="card-title mb-0">
                                <i class="fas fa-terminal text-warning me-2"></i> Custom Configuration
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="custom-css" class="form-label">Custom CSS</label>
                                <textarea class="form-control font-monospace" id="custom-css" rows="6" placeholder="/* Add your custom CSS here */"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="custom-js" class="form-label">Custom JavaScript</label>
                                <textarea class="form-control font-monospace" id="custom-js" rows="6" placeholder="// Add your custom JavaScript here"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Email Template Editor Modal -->
<div class="modal fade" id="emailTemplateModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content bg-dark">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">✉️ Email Template Editor</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Template Content</h6>
                        <textarea class="form-control font-monospace" id="template-content" rows="20"></textarea>
                    </div>
                    <div class="col-md-6">
                        <h6>Preview</h6>
                        <div id="template-preview" class="border rounded p-3" style="min-height: 400px; background: white; color: black;">
                            Template preview will appear here...
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveEmailTemplate()">
                    <i class="fas fa-save"></i> Save Template
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    .settings-tabs .nav-link {
        color: #9aa0a6;
        border-radius: 8px;
        margin: 0 2px;
        transition: all 0.3s ease;
    }
    
    .settings-tabs .nav-link.active {
        background: #ffd700;
        color: #000;
        font-weight: 600;
    }
    
    .settings-tabs .nav-link:hover:not(.active) {
        background: rgba(255, 215, 0, 0.1);
        color: #ffd700;
    }
    
    .card-header {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #3c4043;
        background: rgba(255, 215, 0, 0.05);
    }
    
    .card-header h3 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .card-body {
        padding: 1.5rem;
    }
    
    .form-switch .form-check-input {
        width: 2.5rem;
        height: 1.25rem;
    }
    
    .form-switch .form-check-input:checked {
        background-color: #ffd700;
        border-color: #ffd700;
    }
    
    .form-switch .form-check-input:focus {
        box-shadow: 0 0 0 0.2rem rgba(255, 215, 0, 0.25);
    }
    
    .integration-item {
        padding: 1rem;
        border: 1px solid #3c4043;
        border-radius: 8px;
        background: rgba(255, 215, 0, 0.02);
    }
    
    .integration-card {
        padding: 1rem;
        border: 1px solid #3c4043;
        border-radius: 8px;
        background: rgba(255, 215, 0, 0.02);
        margin-bottom: 1rem;
    }
    
    .api-key-item {
        margin-bottom: 1rem;
    }
    
    .font-monospace {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.875rem;
    }
    
    .form-control-color {
        width: 3rem;
        height: 2.5rem;
    }
    
    /* Loading states */
    .btn.loading {
        position: relative;
        color: transparent;
    }
    
    .btn.loading::after {
        content: '';
        position: absolute;
        width: 16px;
        height: 16px;
        top: 50%;
        left: 50%;
        margin-left: -8px;
        margin-top: -8px;
        border: 2px solid transparent;
        border-top-color: #ffffff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Custom scrollbar for textareas */
    textarea::-webkit-scrollbar {
        width: 8px;
    }
    
    textarea::-webkit-scrollbar-track {
        background: #2d2d30;
    }
    
    textarea::-webkit-scrollbar-thumb {
        background: #ffd700;
        border-radius: 4px;
    }
    
    textarea::-webkit-scrollbar-thumb:hover {
        background: #ffed4a;
    }
</style>

<script>
    let currentEmailTemplate = '';
    let unsavedChanges = false;
    
    document.addEventListener('DOMContentLoaded', function() {
        initializeSystemSettings();
    });
    
    function initializeSystemSettings() {
        loadCurrentSettings();
        setupEventListeners();
        
        console.log('⚙️ System Settings initialized');
    }
    
    function setupEventListeners() {
        // Track changes for unsaved warning
        document.querySelectorAll('input, select, textarea').forEach(element => {
            element.addEventListener('change', () => {
                unsavedChanges = true;
                updateSaveButton();
            });
        });
        
        // Warn before leaving with unsaved changes
        window.addEventListener('beforeunload', function(e) {
            if (unsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    }
    
    function loadCurrentSettings() {
        // In a real implementation, this would load from backend
        console.log('Loading current settings...');
        
        // Demo: Set some default values
        updateSettingStatus();
    }
    
    function updateSaveButton() {
        const saveButton = document.querySelector('.epic-button');
        if (unsavedChanges) {
            saveButton.innerHTML = '<i class="fas fa-save"></i> Save Changes *';
            saveButton.classList.add('btn-warning');
        } else {
            saveButton.innerHTML = '<i class="fas fa-save"></i> Save All Changes';
            saveButton.classList.remove('btn-warning');
        }
    }
    
    function updateSettingStatus() {
        // Update status indicators based on current settings
        const maintenanceMode = document.getElementById('maintenance-mode').checked;
        if (maintenanceMode) {
            showNotification('⚠️ Maintenance mode is currently enabled', 'warning');
        }
    }
    
    async function saveAllSettings() {
        const saveButton = event.target;
        saveButton.classList.add('loading');
        saveButton.disabled = true;
        
        try {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Collect all settings
            const settings = {
                general: collectGeneralSettings(),
                email: collectEmailSettings(),
                security: collectSecuritySettings(),
                api: collectApiSettings(),
                maintenance: collectMaintenanceSettings(),
                advanced: collectAdvancedSettings()
            };
            
            console.log('Saving settings:', settings);
            
            unsavedChanges = false;
            updateSaveButton();
            showNotification('✅ All settings saved successfully!', 'success');
            addToActivityLog('System settings updated', 'success');
            
        } catch (error) {
            showNotification('❌ Failed to save settings: ' + error.message, 'error');
        } finally {
            saveButton.classList.remove('loading');
            saveButton.disabled = false;
        }
    }
    
    function collectGeneralSettings() {
        return {
            site_name: document.getElementById('site-name').value,
            site_description: document.getElementById('site-description').value,
            site_url: document.getElementById('site-url').value,
            admin_email: document.getElementById('admin-email').value,
            timezone: document.getElementById('timezone').value,
            theme_mode: document.getElementById('theme-mode').value,
            primary_color: document.getElementById('primary-color').value,
            features: {
                user_registration: document.getElementById('user-registration').checked,
                email_verification: document.getElementById('email-verification').checked,
                guest_checkout: document.getElementById('guest-checkout').checked,
                reviews_enabled: document.getElementById('reviews-enabled').checked,
                wishlist_enabled: document.getElementById('wishlist-enabled').checked,
                analytics_tracking: document.getElementById('analytics-tracking').checked
            }
        };
    }
    
    function collectEmailSettings() {
        return {
            smtp: {
                host: document.getElementById('smtp-host').value,
                port: document.getElementById('smtp-port').value,
                encryption: document.getElementById('smtp-encryption').value,
                username: document.getElementById('smtp-username').value,
                password: document.getElementById('smtp-password').value
            },
            from_name: document.getElementById('from-name').value,
            from_email: document.getElementById('from-email').value,
            reply_email: document.getElementById('reply-email').value
        };
    }
    
    function collectSecuritySettings() {
        return {
            min_password_length: document.getElementById('min-password-length').value,
            password_requirements: {
                require_uppercase: document.getElementById('require-uppercase').checked,
                require_lowercase: document.getElementById('require-lowercase').checked,
                require_numbers: document.getElementById('require-numbers').checked,
                require_special: document.getElementById('require-special').checked
            },
            session_timeout: document.getElementById('session-timeout').value,
            two_factor_auth: document.getElementById('two-factor-auth').checked,
            login_attempts: document.getElementById('login-attempts').value,
            lockout_duration: document.getElementById('lockout-duration').value,
            allowed_domains: document.getElementById('allowed-domains').value,
            csrf_protection: document.getElementById('csrf-protection').checked,
            ip_logging: document.getElementById('ip-logging').checked
        };
    }
    
    function collectApiSettings() {
        return {
            api_enabled: document.getElementById('api-enabled').checked,
            api_rate_limit: document.getElementById('api-rate-limit').value,
            integrations: {
                stripe_enabled: document.getElementById('stripe-enabled').checked,
                paypal_enabled: document.getElementById('paypal-enabled').checked,
                amazon_pay_enabled: document.getElementById('amazon-pay-enabled').checked,
                google_analytics: document.getElementById('google-analytics').checked,
                mailchimp: document.getElementById('mailchimp').checked,
                aws_s3: document.getElementById('aws-s3').checked
            }
        };
    }
    
    function collectMaintenanceSettings() {
        return {
            maintenance_mode: document.getElementById('maintenance-mode').checked,
            maintenance_message: document.getElementById('maintenance-message').value,
            maintenance_end: document.getElementById('maintenance-end').value,
            auto_backup: document.getElementById('auto-backup').value,
            backup_retention: document.getElementById('backup-retention').value
        };
    }
    
    function collectAdvancedSettings() {
        return {
            debug_mode: document.getElementById('debug-mode').checked,
            log_level: document.getElementById('log-level').value,
            cache_timeout: document.getElementById('cache-timeout').value,
            compress_responses: document.getElementById('compress-responses').checked,
            max_upload_size: document.getElementById('max-upload-size').value,
            pagination_size: document.getElementById('pagination-size').value,
            search_results: document.getElementById('search-results').value,
            cdn_enabled: document.getElementById('cdn-enabled').checked,
            custom_css: document.getElementById('custom-css').value,
            custom_js: document.getElementById('custom-js').value
        };
    }
    
    async function testEmailConnection() {
        const button = event.target;
        const originalText = button.innerHTML;
        
        button.classList.add('loading');
        button.disabled = true;
        
        try {
            // Simulate email test
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            showNotification('✅ Email connection test successful!', 'success');
            addToActivityLog('Email connection tested successfully', 'success');
            
        } catch (error) {
            showNotification('❌ Email connection test failed: ' + error.message, 'error');
        } finally {
            button.classList.remove('loading');
            button.disabled = false;
            button.innerHTML = originalText;
        }
    }
    
    function editEmailTemplate(templateType) {
        currentEmailTemplate = templateType;
        
        const templates = {
            'welcome': {
                subject: 'Welcome to {{site_name}}!',
                content: `<h1>Welcome to {{site_name}}!</h1>
<p>Hi {{user_name}},</p>
<p>Thank you for joining our platform. We're excited to have you as part of our community.</p>
<p>To get started, you can:</p>
<ul>
    <li>Browse our products</li>
    <li>Update your profile</li>
    <li>Start shopping</li>
</ul>
<p>If you have any questions, feel free to contact our support team.</p>
<p>Best regards,<br>The {{site_name}} Team</p>`
            },
            'password-reset': {
                subject: 'Reset Your Password',
                content: `<h1>Password Reset Request</h1>
<p>Hi {{user_name}},</p>
<p>You requested to reset your password. Click the button below to proceed:</p>
<p><a href="{{reset_url}}" style="background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Reset Password</a></p>
<p>This link will expire in 24 hours.</p>
<p>If you didn't request this, please ignore this email.</p>`
            },
            'order-confirmation': {
                subject: 'Order Confirmation #{{order_number}}',
                content: `<h1>Order Confirmation</h1>
<p>Hi {{user_name}},</p>
<p>Thank you for your order! Here are the details:</p>
<p><strong>Order #:</strong> {{order_number}}<br>
<strong>Total:</strong> {{order_total}}</p>
<p>We'll send you shipping information once your order is processed.</p>
<p>Thank you for shopping with us!</p>`
            }
        };
        
        const template = templates[templateType];
        document.getElementById('template-content').value = template.content;
        updateTemplatePreview();
        
        const modal = new bootstrap.Modal(document.getElementById('emailTemplateModal'));
        modal.show();
        
        // Update preview when content changes
        document.getElementById('template-content').addEventListener('input', updateTemplatePreview);
    }
    
    function updateTemplatePreview() {
        const content = document.getElementById('template-content').value;
        const preview = document.getElementById('template-preview');
        
        // Simple template rendering for demo
        let rendered = content
            .replace(/\{\{site_name\}\}/g, 'CartMax Platform')
            .replace(/\{\{user_name\}\}/g, 'John Doe')
            .replace(/\{\{order_number\}\}/g, '12345')
            .replace(/\{\{order_total\}\}/g, '$99.99')
            .replace(/\{\{reset_url\}\}/g, '#');
        
        preview.innerHTML = rendered;
    }
    
    function saveEmailTemplate() {
        showNotification('✅ Email template saved successfully!', 'success');
        addToActivityLog(`Updated ${currentEmailTemplate} email template`, 'success');
        
        const modal = bootstrap.Modal.getInstance(document.getElementById('emailTemplateModal'));
        modal.hide();
    }
    
    function regenerateApiKey(keyType) {
        if (confirm('Are you sure you want to regenerate this API key? This will invalidate the current key.')) {
            const newKey = 'sk_live_' + Math.random().toString(36).substring(2, 15);
            event.target.parentElement.querySelector('input').value = newKey;
            showNotification('🔑 API key regenerated successfully!', 'success');
            addToActivityLog(`Regenerated ${keyType} API key`, 'info');
            unsavedChanges = true;
            updateSaveButton();
        }
    }
    
    async function optimizeDatabase() {
        const button = event.target;
        button.classList.add('loading');
        button.disabled = true;
        
        try {
            await new Promise(resolve => setTimeout(resolve, 3000));
            showNotification('🗄️ Database optimization completed!', 'success');
            addToActivityLog('Database optimized', 'success');
        } catch (error) {
            showNotification('❌ Database optimization failed: ' + error.message, 'error');
        } finally {
            button.classList.remove('loading');
            button.disabled = false;
        }
    }
    
    async function createBackup() {
        const button = event.target;
        button.classList.add('loading');
        button.disabled = true;
        
        try {
            await new Promise(resolve => setTimeout(resolve, 2000));
            showNotification('💾 Database backup created successfully!', 'success');
            addToActivityLog('Database backup created', 'success');
        } catch (error) {
            showNotification('❌ Backup creation failed: ' + error.message, 'error');
        } finally {
            button.classList.remove('loading');
            button.disabled = false;
        }
    }
    
    async function clearCache() {
        const button = event.target;
        button.classList.add('loading');
        button.disabled = true;
        
        try {
            await new Promise(resolve => setTimeout(resolve, 1000));
            showNotification('🧹 Cache cleared successfully!', 'success');
            addToActivityLog('System cache cleared', 'success');
        } catch (error) {
            showNotification('❌ Cache clearing failed: ' + error.message, 'error');
        } finally {
            button.classList.remove('loading');
            button.disabled = false;
        }
    }
    
    function resetToDefaults() {
        if (confirm('Are you sure you want to reset all settings to their default values? This action cannot be undone.')) {
            location.reload();
            showNotification('⚠️ Settings reset to defaults', 'warning');
            addToActivityLog('Settings reset to defaults', 'warning');
        }
    }
    
    function exportSettings() {
        const settings = {
            general: collectGeneralSettings(),
            email: collectEmailSettings(),
            security: collectSecuritySettings(),
            api: collectApiSettings(),
            maintenance: collectMaintenanceSettings(),
            advanced: collectAdvancedSettings(),
            exported_at: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(settings, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `settings-backup-${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
        
        showNotification('📥 Settings exported successfully!', 'success');
        addToActivityLog('Settings configuration exported', 'info');
    }
    
    // Utility functions
    function addToActivityLog(message, type) {
        // This would integrate with the main activity log system
        console.log(`[${type.toUpperCase()}] ${message}`);
    }
    
    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info'} position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; width: 350px;';
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }
    
    console.log('⚙️ System Settings & Configuration Loaded Successfully!');
</script>
{% endblock %}